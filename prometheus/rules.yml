groups:
  - name: prometheus-rules
    rules:
      - alert: NodeNetworkReceiveErrs [ap-south-1]
        annotations:
          description: >-
            {{ $labels.instance }} interface {{ $labels.device }} has
            encountered {{ printf "%.0f" $value }} receive errors in the last
            two minutes.
          summary: Network interface is reporting many receive errors .
        expr: >-
          rate(node_network_receive_errs_total{}[2m]) /
          rate(node_network_receive_packets_total{}[2m]) > 0.01
        for: 1h
        labels:
          severity: emergency
      - alert: HostOutOfDiskSpace [ap-south-1] 
        expr: (node_filesystem_avail_bytes * 100) / node_filesystem_size_bytes < 10 and ON (instance, device, mountpoint) node_filesystem_readonly == 0
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: Host out of disk space (instance {{ $labels.instance }})
          description: "Disk is almost full (< 10% left)\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"
      - alert: NodeTextFileCollectorScrapeError [ap-south-1]
        annotations:
          description: Node Exporter text file collector failed to scrape.
          summary: Node Exporter text file collector failed to scrape.
        expr: 'node_textfile_scrape_error{} == 1'
        labels:
          severity: emergency
      - alert: HostOutOfDiskSpace [ap-south-1]
        annotations:
          description: |-
            Disk is almost full (< 10% left)
              VALUE = {{ $value }}

          summary: 'Host out of disk space (instance {{ $labels.instance }})'
        expr: >-
          (node_filesystem_avail_bytes{} * 100) / node_filesystem_size_bytes{} <
          10 and ON (instance, device, mountpoint) node_filesystem_readonly{} ==
          0
        for: 10m
        labels:
          severity: emergency
      - alert: LoadAverageHigh [ap-south-1]
        annotations:
          description: |-
            "{{ $labels.instance  }} (measured by {{ $labels.job }}) has high load average ({{ $value }}) over 5 minutes."
          summary: "Instance {{ $labels.instance }} - high load average"
        expr: >-
          node_load5 {} / count by (instance, job) (node_cpu_seconds_total{}) >= 7.95
        for: 5m
        labels:
          severity: emergency
      - alert: HostOutOfMemory [ap-south-1]
        annotations:
          description: >-
            Memory  is almost full in the instance {{ $labels.instance }} VALUE
            = {{ $value }} is left
          summary: Host out of memory
        expr: >-
          node_memory_MemAvailable_bytes {} / node_memory_MemTotal_bytes{} * 100 < 2
        for: 1m
        labels:
          severity: emergency
      - alert: HostMemoryUnderMemoryPressure [ap-south-1]
        expr: 'rate(node_vmstat_pgmajfault[1m]) > 1000'
        for: 2m
        labels:
          severity: emergency
        annotations:
          summary: 'Host memory under memory pressure (instance {{ $labels.instance }})'
          description: >-
            The node is under heavy memory pressure. High rate of major page
            faults
              VALUE = {{ $value }}
              LABELS = {{ $labels }}
      - alert: HostUnusualNetworkThroughputIn [ap-south-1]
        expr: >-
          sum by (instance) (rate(node_network_receive_bytes_total{}[2m])) /
          1024 / 1024 > 100
        for: 5m
        labels:
          severity: emergency
        annotations:
          summary: 'Host unusual network throughput in (instance {{ $labels.instance }})'
          description: >-
            Host network interfaces are probably receiving too much data (> 100
            MB/s)
              VALUE = {{ $value }}
              LABELS = {{ $labels }}
      - alert: HostUnusualNetworkThroughputOut [ap-south-1]
        expr: >-
          sum by (instance) (rate(node_network_transmit_bytes_total{}[2m])) /
          1024 / 1024 > 100
        for: 5m
        labels:
          severity: emergency
        annotations:
          summary: >-
            Host unusual network throughput out (instance {{ $labels.instance
            }})
          description: >-
            Host network interfaces are probably sending too much data (> 100
            MB/s)
              VALUE = {{ $value }}
              LABELS = {{ $labels }}
      - alert: HostHighCpuLoad [ap-south-1]
        expr: 100 - (avg by(instance) (rate(node_cpu_seconds_total{mode="idle"}[2m])) * 100) > 96
        for: 15m
        labels:
          severity: warning
        annotations:
          summary: Host high CPU load (instance {{ $labels.instance }})
          description: "CPU load is > 90%\n  VALUE = {{ $value }}\n  LABELS = {{ $labels }}"
      - alert: HostSystemdServiceCrashed [ap-south-1]
        expr: 'node_systemd_unit_state{state="failed", name!="fwupd-refresh.service"} == 1'
        for: 0m
        labels:
          severity: emergency
        annotations:
          summary: 'Host systemd service crashed (instance {{ $labels.instance }})'
          description: |-
            systemd service crashed
      - alert: HostNetworkReceiveErrors [ap-south-1]
        expr: >-
          rate(node_network_receive_errs_total{}[2m]) /
          rate(node_network_receive_packets_total{}[2m]) > 0.01
        for: 2m
        labels:
          severity: emergency
        annotations:
          summary: 'Host Network Receive Errors (instance {{ $labels.instance }})'
          description: >-
            Host {{ $labels.instance }} interface {{ $labels.device }} has
            encountered {{ printf "%.0f" $value }} receive errors in the last
            five minutes.
              VALUE = {{ $value }}
              LABELS = {{ $labels }}
      - alert: HostNetworkTransmitErrors [ap-south-1]
        expr: >-
          rate(node_network_transmit_errs_total{}[2m]) /
          rate(node_network_transmit_packets_total{}[2m]) > 0.01
        for: 2m
        labels:
          severity: emergency
        annotations:
          summary: 'Host Network Transmit Errors (instance {{ $labels.instance }})'
          description: >-
            Host {{ $labels.instance }} interface {{ $labels.device }} has
            encountered {{ printf "%.0f" $value }} transmit errors in the last
            five minutes.
              VALUE = {{ $value }}
              LABELS = {{ $labels }}
